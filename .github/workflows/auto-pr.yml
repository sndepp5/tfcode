name: Auto Pull Request
#test
 

on:
  push:
    branches:
      - 'feature/*'  # Replace with the name of your source branch

 

jobs:
  create_pull_request:
    runs-on: ubuntu-latest

 

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

 

    - name: Set PR Title with Action ID
      id: set-pr-title
      run: |
        TOKEN=${{ secrets.TOCKEN_GIT }}
        echo "BRANCH_NAME=$(basename ${{ github.ref }})" >> $GITHUB_ENV
        BRANCH_NAME=$(echo "$BRANCH_NAME" | sed 's/^refs\/heads\///')
        SOURCE_BRANCH=$BRANCH_NAME  # Replace with the name of your source branch
        TARGET_BRANCH=main  # Replace with the name of your target branch
        REPO=${{ github.repository }}
        ACTION_ID=${{ github.run_id }}  # Unique Action ID
        TITLE="Auto PR from $SOURCE_BRANCH to $TARGET_BRANCH (Action #$ACTION_ID)"
        BODY="This pull request was automatically generated by Action #$ACTION_ID."

 

        echo "::set-output name=title::$TITLE"
        echo "::set-output name=body::$BODY"
      env:
        TOKEN: ${{ secrets.TOCKEN_GIT }}

 

    - name: Create Pull Request
      run: |
        TOKEN=${{ secrets.TOCKEN_GIT }}
        echo "BRANCH_NAME=$(basename ${{ github.ref }})" >> $GITHUB_ENV
        BRANCH_NAME=$(echo "$BRANCH_NAME" | sed 's/^refs\/heads\///')
        TITLE="${{ steps.set-pr-title.outputs.title }}"
        BODY="${{ steps.set-pr-title.outputs.body }}"
        SOURCE_BRANCH=$BRANCH_NAME  # Replace with the name of your source branch
        TARGET_BRANCH=main  # Replace with the name of your target branch
        REPO=${{ github.repository }}

 

        curl -X POST \
          -H "Accept: application/vnd.github.v3+json" \
          -H "Authorization: Bearer $TOKEN" \
          https://api.github.com/repos/$REPO/pulls \
          -d '{"title":"'"$TITLE"'","body":"'"$BODY"'","head":"'"$SOURCE_BRANCH"'","base":"'"$TARGET_BRANCH"'"}'
      env:
        TOKEN: ${{ secrets.TOCKEN_GIT }}